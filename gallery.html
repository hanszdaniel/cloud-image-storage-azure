<!DOCTYPE html>
<html>
<head>
    <title>Image Gallery</title>
    <style>
        body {
            font-family: Arial;
            margin: 0;
        }

        nav {
            background: #1e40af;
            padding: 12px 20px;
            display: flex;
            gap: 20px;
            font-size: 18px;
        }

        nav a {
            color: white;
            text-decoration: none;
        }

        h2 {
            text-align: center;
            margin: 30px 0;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            max-width: 1000px;
            margin: auto;
        }

        .gallery img {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .status {
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
        }

        .card {
    position: relative;
}

.delete-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #dc2626;
    color: white;
    border: none;
    padding: 5px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

    </style>
</head>

<body>

<!-- NAVBAR -->
<nav>
    <a href="index.html">Upload</a>
    <a href="gallery.html">Gallery</a>
</nav>

<h2>Image Gallery</h2>
<p class="status" id="status">Loading images...</p>

<div class="gallery" id="gallery"></div>

<script>
async function loadImages() {
    const status = document.getElementById("status");
    const gallery = document.getElementById("gallery");

    try {
        const response = await fetch(
            "https://cloudimagestorage-bdh3btf0czh6hve0.westeurope-01.azurewebsites.net/api/listimages"
        );

        const text = await response.text();
        const images = text ? JSON.parse(text) : [];

        if (!images.length) {
            status.innerText = "No images uploaded yet.";
            return;
        }

        status.innerText = "";

        images.forEach(img => {
    const card = document.createElement("div");
    card.className = "card";

    const imageEl = document.createElement("img");
    imageEl.src = img.url;
    imageEl.alt = img.fileName;

    const deleteBtn = document.createElement("button");
    deleteBtn.className = "delete-btn";
    deleteBtn.innerText = "Delete";
    deleteBtn.onclick = () => deleteImage(img.name, card);

    card.appendChild(imageEl);
    card.appendChild(deleteBtn);
    gallery.appendChild(card);
});


    } catch (err) {
        console.error(err);
        status.innerText = "Failed to load images.";
        status.style.color = "red";
    }
}

loadImages();

async function deleteImage(fileName, card) {
    if (!confirm("Delete this image?")) return;

    try {
        const response = await fetch(
            "https://cloudimagestorage-bdh3btf0czh6hve0.westeurope-01.azurewebsites.net/api/deleteimage",
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ fileName })
            }
        );

        if (!response.ok) {
            const errText = await response.text();
            throw new Error(errText);
        }

        // âœ… SUCCESS
        card.remove();

    } catch (err) {
        console.error(err);
        alert("Failed to delete image");
    }
}

</script>

</body>
</html>
