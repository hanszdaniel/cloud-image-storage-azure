<!DOCTYPE html>
<html>
<head>
    <title>Upload Image</title>
</head>
<body style="font-family: Arial;">

<!-- NAVBAR -->
<nav style="
    background:#1e40af;
    padding:12px 20px;
    display:flex;
    gap:20px;
    font-size:18px;
">
    <a href="index.html" style="color:white; text-decoration:none;">Upload</a>
    <a href="gallery.html" style="color:white; text-decoration:none;">Gallery</a>
</nav>

<div style="
    max-width:450px;
    margin:50px auto;
    padding:25px;
    border:1px solid #ddd;
    border-radius:10px;
    text-align:center;
    box-shadow:0px 4px 12px rgba(0,0,0,0.1);
">

    <h2 style="margin-bottom:20px;">Upload Image to Azure</h2>

    <input type="file" id="fileInput" accept="image/*" style="margin-bottom:15px;"><br>

    <button id="uploadBtn" onclick="uploadImage()" style="
        background:#1e40af; 
        color:white;
        padding:10px 20px;
        border:none;
        border-radius:6px;
        cursor:pointer;
        font-size:16px;
    ">Upload</button>

    <p id="status" style="margin-top:20px; font-weight:bold;"></p>
</div>

<script>
async function uploadImage() {
  const fileInput = document.getElementById("fileInput");
  const status = document.getElementById("status");
  const uploadBtn = document.getElementById("uploadBtn");
  const file = fileInput.files[0];

  if (!file) {
    status.style.color = "red";
    status.innerText = "Please select an image first.";
    return;
  }

  status.style.color = "#1e40af";
  status.innerText = "Uploading...";
  uploadBtn.disabled = true;

  const reader = new FileReader();

  reader.onload = async function () {
    const base64Image = reader.result.split(",")[1];

    try {
      const response = await fetch(
        "https://cloudimagestorage-bdh3btf0czh6hve0.westeurope-01.azurewebsites.net/api/uploadimage",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            fileName: file.name,
            image: base64Image
          })
        }
      );

      const responseText = await response.text();
      let data = {};

      try {
        data = responseText ? JSON.parse(responseText) : {};
      } catch {
        throw new Error("Invalid server response");
      }

      if (!response.ok) {
        throw new Error(data.error || "Upload failed");
      }

      status.style.color = "green";
      status.innerText = "Upload successful!";
      console.log(data);

      fileInput.value = "";

    } catch (err) {
      console.error(err);
      status.style.color = "red";
      status.innerText = err.message;
    } finally {
      uploadBtn.disabled = false;
    }
  };

  reader.readAsDataURL(file);
}
</script>


</body>
</html>
